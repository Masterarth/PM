<?php

require 'bin/fpdf/fpdf.php';

/**
 * PDF Export for an Project Proposal
 *
 * @author Lukas Adler
 */
class pm_pdfcreator {

    public $o_fpdf;
    public $o_project;

    /**
     * Constructor 
     * @param int Project Proposal ID
     */
    public function __construct($i_ppID) {
        $o_fpdf = new FPDF();
        $o_fpdf->SetTitle("Projektantrag");
        $o_fpdf->SetAuthor("Autogenerated by PAMS");
        $o_fpdf->AddPage();
        $this->setImage($o_fpdf);

        $o_projekt = core()->db()->select("select p.*, a.a_name, a.s_id, s.s_name from projekt p "
                . "left join abteilung a on a.id = p.a_id "
                . "left join standort s on s.id = a.s_id where p.id = " . $i_ppID, "fetch");
        $this->pdfHeadline($o_fpdf, $o_projekt);
        $this->pdfContent($o_fpdf, $o_projekt);
        $o_fpdf->Output();


        var_dump($o_projekt);
    }

    /**
     * Sets the Headline
     * @param type $pdf
     * @param type $project
     */
    public function pdfHeadline($pdf, $project) {
        //FONT Einstellung
        $pdf->SetTextColor(0, 128, 128);
        $pdf->SetFont('Arial', 'B', 18);
        $pdf->Text(10, 148, $project->titel);
    }

    public function pdfContent($pdf, $project) {
        //Start Datum
        $pdf->SetTextColor(0,128,128);
        $pdf->SetFont('Arial','B',14);
        $pdf->Text(10, 160, '| Startdatum');
        $pdf->SetTextColor(0,0,0);
        $pdf->SetFont('Arial','',12);
        $pdf->Text(10, 165, $project->vor_sta_term);
        
        //Enddatum
        $pdf->SetTextColor(0,128,128);
        $pdf->SetFont('Arial','B',14);
        $pdf->Text(90, 160, '| Enddatum');
        $pdf->SetTextColor(0,0,0);
        $pdf->SetFont('Arial','',12);
        $pdf->Text(90, 165, $project->vor_end_term);
        
        //Kurzbeschreibung
        $pdf->SetTextColor(0,128,128);
        $pdf->SetFont('Arial','B',14);
        $pdf->Text(10, 175, '| Kurzbeschreibung');
        $pdf->SetTextColor(0,0,0);
        $pdf->SetFont('Arial','',12);
        $pdf->Text(10, 180, $project->beschreibung);
        
        //Rahmenbedinungen
        $pdf->SetTextColor(0,128,128);
        $pdf->SetFont('Arial','B',14);
        $pdf->Text(10, 190, '| Rahmenbedingungen');
        $pdf->SetTextColor(0,0,0);
        $pdf->SetFont('Arial','',12);
        $pdf->Text(10, 195, $project->rahmbeding);
        
        //Kommunikationskonzept
        $pdf->SetTextColor(0,128,128);
        $pdf->SetFont('Arial','B',14);
        $pdf->Text(10, 205, '| Kommunikationskonzept');
        $pdf->SetTextColor(0,0,0);
        $pdf->SetFont('Arial','',12);
        $pdf->Text(10, 210, $project->komm_konz);
        
        //Kreuzzielmethode
        $pdf->SetTextColor(0,128,128);
        $pdf->SetFont('Arial','B',14);
        $pdf->Text(10, 220, '| Kreuzzielmethode');
        
        $pdf->SetTextColor(0,128,128);
        $pdf->SetFont('Arial','',12);
        $pdf->Text(10, 225, '| Wozu?');
        $pdf->SetTextColor(0,0,0);
        $pdf->SetFont('Arial','',12);
        $pdf->Text(10, 230, $project->p_ziel1);
        
        $pdf->SetTextColor(0,128,128);
        $pdf->SetFont('Arial','',12);
        $pdf->Text(90, 225, '| Was?');
        $pdf->SetTextColor(0,0,0);
        $pdf->SetFont('Arial','',12);
        $pdf->Text(90, 230, $project->p_ziel2);
        
        $pdf->SetTextColor(0,128,128);
        $pdf->SetFont('Arial','',12);
        $pdf->Text(10, 240, '| Wie gut?');
        $pdf->SetTextColor(0,0,0);
        $pdf->SetFont('Arial','',12);
        $pdf->Text(10, 245, $project->p_ziel3);
        
        $pdf->SetTextColor(0,128,128);
        $pdf->SetFont('Arial','',12);
        $pdf->Text(90, 240, '| Wen?');
        $pdf->SetTextColor(0,0,0);
        $pdf->SetFont('Arial','',12);
        $pdf->Text(90, 245, $project->p_ziel4);
    }

    /**
     * Sets a Header Image to the PDF
     * @param fpdf-Object $pdf
     */
    public function setImage($pdf) {
        $pdf->Image('bin/custom/images/projekt_2.jpg', 0, 0, 210, 140, 'jpg');
    }

    public function createPdf() {
        
    }

}
